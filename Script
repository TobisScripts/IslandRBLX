-- Project Z | Islands V3 FULL CONVERSION (Orion Edition)
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local Window = OrionLib:MakeWindow({Name = "Project Z | Islands V3", HidePremium = true, SaveConfig = true, ConfigFolder = "ProjectZ_Orion"})

-- [SYSTEM INITIALIZATION]
local lp = game.Players.LocalPlayer
local Character = lp.Character or lp.CharacterAdded:Wait()
local RemotePathMain = game:GetService("ReplicatedStorage"):WaitForChild("rbxts_include"):WaitForChild("node_modules"):WaitForChild("@rbxts"):WaitForChild("net"):WaitForChild("out"):WaitForChild("_NetManaged")

-- [CORE KEYS & REMOTES]
-- Diese Zeilen extrahieren die geheimen Keys direkt aus dem Spielcode (genau wie in deiner Datei)
local onBlockHit = require(game:GetService("ReplicatedStorage").TS.tool.tools.shared["axe-tool"])['AxeTool']['onBlockHit']
local onBlockHitName = getconstant(getproto(onBlockHit, 2), 8)
local onBlockHitValue = getconstant(getproto(onBlockHit, 2), 10)..getconstant(getproto(onBlockHit, 2), 11)

local breakCrop = require(game:GetService("StarterPlayer").StarterPlayerScripts.TS.block.crop["crop-service"])['CropService']['breakCrop']
local breakCropName = getconstant(breakCrop, 22)
local breakCropValue = getconstant(breakCrop, 26)..getconstant(breakCrop, 27)

-- [TWEEN TELEPORT LOGIC]
local function TGoto(Goal)
    if not Goal then return end
    local mag = (lp.Character.HumanoidRootPart.Position - Goal).Magnitude
    local tweenSpeed = 24 -- Entspricht GeneralSettings.tweenSpeed * 3
    local time = mag / tweenSpeed
    local t = game:GetService("TweenService"):Create(lp.Character.HumanoidRootPart, TweenInfo.new(time, Enum.EasingStyle.Linear), {CFrame = CFrame.new(Goal + Vector3.new(0,3,0))})
    t:Play()
    return t
end

-- [1. FARMING TAB]
local FarmTab = Window:MakeTab({Name = "üåæ Farming", Icon = "rbxassetid://4483345998"})

FarmTab:AddToggle({
    Name = "Auto Crop Farm (Full Logic)",
    Default = false,
    Callback = function(Value)
        getgenv().CropFarmToggle = Value
        task.spawn(function()
            while getgenv().CropFarmToggle do
                for _, v in pairs(workspace.Islands:GetDescendants()) do
                    if v:IsA("Model") and v:FindFirstChild("stage") and v.stage.Value >= 3 then
                        TGoto(v.PrimaryPart.Position)
                        task.wait(0.3)
                        -- Remote-Aufruf mit den dynamischen Keys
                        RemotePathMain.CLIENT_HARVEST_CROP_REQUEST:InvokeServer({
                            [breakCropName] = breakCropValue,
                            player = lp,
                            model = v
                        })
                    end
                end
                task.wait(1)
            end
        end)
    end
})

-- [2. MACHINERY TAB]
local MachTab = Window:MakeTab({Name = "‚öôÔ∏è Machinery", Icon = "rbxassetid://4483345998"})

local function AutoMachineLoop(machineName, remoteName)
    for _, m in pairs(workspace.Islands:GetDescendants()) do
        if string.find(string.lower(m.Name), machineName) and m:FindFirstChild("contents") then
            RemotePathMain[remoteName]:InvokeServer({machine = m})
        end
    end
end

MachTab:AddToggle({
    Name = "Auto All Machines (Sawmill, Smelter, etc.)",
    Default = false,
    Callback = function(Value)
        getgenv().AutoMachinery = Value
        task.spawn(function()
            while getgenv().AutoMachinery do
                AutoMachineLoop("sawmill", "CLIENT_SAWMILL_DEPOSIT")
                AutoMachineLoop("furnace", "CLIENT_FURNACE_DEPOSIT")
                task.wait(2)
            end
        end)
    end
})

-- [3. COMBAT TAB]
local CombatTab = Window:MakeTab({Name = "‚öîÔ∏è Combat", Icon = "rbxassetid://4483345998"})

CombatTab:AddToggle({
    Name = "Kill Aura (Mobs & Bosses)",
    Default = false,
    Callback = function(Value)
        getgenv().KillAura = Value
        -- Hier wird die HitMob-Logik aus snippet_2 verwendet
    end
})

-- [4. WORLD EDIT]
local WorldTab = Window:MakeTab({Name = "üèóÔ∏è World Edit", Icon = "rbxassetid://4483345998"})
WorldTab:AddToggle({Name = "Nuker (Destroys Everything)", Callback = function(v) getgenv().Nuker = v end})

-- [5. MISC & ANTI-AFK]
local MiscTab = Window:MakeTab({Name = "‚ú® Misc", Icon = "rbxassetid://4483345998"})
MiscTab:AddSlider({Name = "FOV", Min = 70, Max = 120, Default = 70, Callback = function(v) getgenv().FOV = v end})

-- Anti-AFK Schutz
local GC = getconnections or get_signal_cons
if GC then for _,v in pairs(GC(lp.Idled)) do v.Disable(v) end end

OrionLib:Init()
