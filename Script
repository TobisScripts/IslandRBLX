-- Rayfield Library Loading
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Initialization
repeat task.wait() until game:IsLoaded() and game.Players.LocalPlayer and game.Players.LocalPlayer.Character

local lp = game.Players.LocalPlayer
local Character = lp.Character or lp.CharacterAdded:Wait()
local RemotePathMain = game:GetService("ReplicatedStorage"):WaitForChild("rbxts_include"):WaitForChild("node_modules"):WaitForChild("@rbxts"):WaitForChild("net"):WaitForChild("out"):WaitForChild("_NetManaged")

-- Window Setup
local Window = Rayfield:CreateWindow({
   Name = "Project Z | Islands V3",
   LoadingTitle = "Project Z | Farming Edition",
   LoadingSubtitle = "by Islands DEV",
   ConfigurationSaving = { Enabled = true, FolderName = "ProjectZ", FileName = "Config" }
})

-----------------------------------------------------------
-- CORE LOGIC (Remotes & Keys from your script)
-----------------------------------------------------------

-- Dynamic Keys Grabbing
local onBlockHit = require(game:GetService("ReplicatedStorage").TS.tool.tools.shared["axe-tool"])['AxeTool']['onBlockHit']
local onBlockHitName = getconstant(getproto(onBlockHit, 2), 8)
local onBlockHitValue = getconstant(getproto(onBlockHit, 2), 10)..getconstant(getproto(onBlockHit, 2), 11)

local breakCrop = require(game:GetService("StarterPlayer").StarterPlayerScripts.TS.block.crop["crop-service"])['CropService']['breakCrop']
local breakCropName = getconstant(breakCrop, 22)
local breakCropValue = getconstant(breakCrop, 26)..getconstant(breakCrop, 27)

-- Tables
local CropTypes = {'wheat','tomato','carrot','cactus','chiliPepper','onion','pineapple','potato','pumpkin','rice','spinach','starfruit'}
local MobTypes = {'slime', 'buffalkor', 'wizardLizard', 'skorp'}

-- States
getgenv().AutoFarmCrops = false
getgenv().KillAura = false
local SelectedCrops = {}

-------------------------
-- FUNCTIONS
-------------------------

local function Harvest(crop)
    RemotePathMain.CLIENT_HARVEST_CROP_REQUEST:InvokeServer({
        [breakCropName] = breakCropValue,
        player = lp,
        model = crop
    })
end

local function TGoto(pos)
    lp.Character.HumanoidRootPart.CFrame = CFrame.new(pos + Vector3.new(0, 2, 0))
end

-------------------------
-- UI TABS
-------------------------

local FarmTab = Window:CreateTab("üåæ Auto Farm", 4483362458)

FarmTab:CreateSection("Crop Farming")

FarmTab:CreateToggle({
   Name = "Auto Harvest Crops",
   CurrentValue = false,
   Flag = "HarvestToggle",
   Callback = function(Value)
      getgenv().AutoFarmCrops = Value
      task.spawn(function()
         while getgenv().AutoFarmCrops do
            for _, v in pairs(workspace.Islands:GetDescendants()) do
               if v:IsA("Model") and v:FindFirstChild("stage") and v.stage.Value >= 3 then
                  if table.find(SelectedCrops, v.Name) or #SelectedCrops == 0 then
                     TGoto(v.PrimaryPart.Position)
                     Harvest(v)
                     task.wait(0.2)
                  end
               end
            end
            task.wait(1)
         end
      end)
   end,
})

FarmTab:CreateDropdown({
   Name = "Select Crops to Farm",
   Options = CropTypes,
   CurrentValue = {"wheat"},
   MultiSelection = true,
   Callback = function(Options)
      SelectedCrops = Options
   end,
})

local CombatTab = Window:CreateTab("‚öîÔ∏è Combat", 4483362458)

CombatTab:CreateToggle({
   Name = "Mob Kill Aura",
   CurrentValue = false,
   Flag = "KillAura",
   Callback = function(Value)
      getgenv().KillAura = Value
      task.spawn(function()
         while getgenv().KillAura do
            -- Kill Logic here
            task.wait(0.5)
         end
      end)
   end,
})

Rayfield:Notify({Title = "Ready!", Content = "Autofarm and UI loaded successfully.", Duration = 5})
